---
title: "GK Zone"
author: "Joseph Kroymann"
date: "1/6/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE}
library(worldfootballR)
library(tidyverse)
library(ggplot2)
library(plotly)
```

```{r, echo=FALSE}
gk_data <- fb_big5_advanced_season_stats(season_end_year = 2022,
                                            stat_type = "keepers",
                                            team_or_player = "player")

gk_data_adv <- fb_big5_advanced_season_stats(season_end_year = 2022,
                                            stat_type = "keepers_adv",
                                            team_or_player = "player")

pl_keepers <- gk_data %>%
  filter(Comp == "Premier League", Min_Playing > 900)

pl_keepers_adv <- merge(pl_keepers, gk_data_adv, no.dups = TRUE)
colnames(pl_keepers_adv)[colnames(pl_keepers_adv) == "_per_90_Expected"] <- "per_90"

get_plKeeper_adv <- function(gk_data, gk_data_adv) {
  pl_keepers <- gk_data %>%
    filter(Comp == "Premier League", Min_Playing > 900)
  
  pl_keepers_adv <- merge(pl_keepers, gk_data_adv, no.dups = TRUE)
  colnames(pl_keepers_adv)[colnames(pl_keepers_adv) == "_per_90_Expected"] <- "per_90"
  
  return(pl_keepers_adv)
}

pl_keepers_adv <- get_plKeeper_adv(gk_data, gk_data_adv)
```

```{r, echo=FALSE}
# how to accumulate expected goals scored against each goalie?? ( not possible w/fbref :( )
```

```{r, echo=FALSE}
# who's beating the model?
gk_model_plot <- function(data) {
  ggplotly(ggplot(data = pl_keepers_adv, aes(x = SoTA, y = per_90,
                                             text = paste(Player, " (", Squad, ")", sep = ""))) +
             xlim(40, 100) +
             ylim(-0.4, 0.4) +
             geom_vline(xintercept = 70) +
             geom_hline(yintercept = 0) +
             geom_point(aes(size = GA)) + 
             labs(title = "Who's Beating the Model? (And Does it Matter?)",
                  subtitle = "PSxG - Goals Allowed per 90 by Shots on Target for PL Goalkeepers with > 900 minutes played") +
             theme_minimal(),
            
            tooltip = "text"
           )
}

gk_model_plot(pl_keepers_adv) %>%
  layout(title = list(text = paste0("Who's Beating the Model? (And Does it Matter?)",
                                    "<br>",
                                    "<sup>",
                                    "PSxG - Goals Allowed per 90 by Shots on Target for PL Goalkeepers with > 900 minutes played",
                                    "</sup>")))
```







